{% extends 'layout.html.twig' %}

{% block body %}
    <div class="row">
        <div class="col">
            <form class="d-flex mt-4 mb-4 w-50" role="search">
                <input class="form-control me-2" type="search" placeholder="{{ 'pel.search.your.declarations'|trans }}" aria-label="{{ 'pel.search.your.declarations'|trans }}">
                <button class="btn btn-outline-primary" type="submit">{{ 'pel.search'|trans }}</button>
            </form>
        </div>
    </div>
    <div class="row mb-5">
        <div class="col">
            <table class="table table-striped" data-order="{{ [[1,'asc']]|json_encode }}" data-columnDefs="{{ [{orderable: false, targets: 0}]|json_encode }}" data-page-length="25" data-controller="datatable" id="datatable">
                <thead class="table-head">
                <tr>
                    <th scope="col">
                        <input type="checkbox" class="form-check-input" id="checkOrUncheckAll">
                    </th>
                    <th scope="col">{{ 'pel.deposit.date'|trans }}</th>
                    <th scope="col">{{ 'pel.facts'|trans }}</th>
                    <th scope="col">{{ 'pel.facts.date'|trans }}</th>
                    <th scope="col">{{ 'pel.alert'|trans }}</th>
                    <th scope="col">{{ 'pel.meeting.date'|trans }}</th>
                    <th scope="col">{{ 'pel.firstname.lastname'|trans }}</th>
                    <th scope="col">{{ 'pel.status'|trans }}</th>
                    <th scope="col">{{ 'pel.a.opj.name'|trans }}</th>
                    <th scope="col">{{ 'pel.declaration.number'|trans }}</th>
                    <th scope="col">{{ 'pel.comments'|trans }}</th>
                </tr>
                </thead>
                <tbody>
                {% for complaint in complaints %}
                    {% if complaint.status == constant('App\\Entity\\Complaint::STATUS_ASSIGNMENT_PENDING') %}
                        {% set status_btn_color = 'secondary' %}
                    {% elseif complaint.status == constant('App\\Entity\\Complaint::STATUS_ASSIGNED') %}
                        {% set status_btn_color = 'primary' %}
                    {% elseif complaint.status == constant('App\\Entity\\Complaint::STATUS_ONGOING_LRP') %}
                        {% set status_btn_color = 'warning' %}
                    {% elseif complaint.status == constant('App\\Entity\\Complaint::STATUS_MP_DECLARANT') %}
                        {% set status_btn_color = 'success' %}
                    {% elseif complaint.status == constant('App\\Entity\\Complaint::STATUS_REJECTED') %}
                        {% set status_btn_color = 'danger' %}
                    {% endif %}
                    <tr>
                        <td>
                            <input type="checkbox" class="form-check-input">
                        </td>
                        <td>{{ complaint.createdAt|date('d/m/Y', app.user.timezone) }}</td>
                        <td>{% include 'common/_complaint_natures.html.twig' with {'natures':complaint.facts.natures} only %}</td>
                        <td>{{ complaint.facts.startDate|date('d/m/Y') }}</td>
                        <td>{{ complaint.alert|u.truncate(15, '...') }}</td>
                        <td>{{ complaint.appointmentDate|date('d/m/Y') }}</td>
                        <td>{{ (complaint.identity.firstName ~ ' ' ~ complaint.identity.lastName)|u.truncate(15, '...') }}</td>
                        <td>
                            <a href="{{ path('complaint_summary', {id:complaint.id}) }}" target="_blank" class="btn btn-sm btn-{{ status_btn_color }}">{{ complaint.status|trans|u.truncate(15, '...') }}</a>
                        </td>
                        <td>{{ complaint.assignedTo|user_appellation|u.truncate(15, '...') }}</td>
                        <td>
                            <a href="{{ path('complaint_summary', {id: complaint.id}) }}" target="_blank">{{ complaint.declarationNumber }}</a>
                        </td>
                        <td>{{ complaint.comments|length }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>

        </div>
    </div>
{% endblock %}
