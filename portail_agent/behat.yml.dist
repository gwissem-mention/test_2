.extensions: &extensions
     extensions:
         FriendsOfBehat\SymfonyExtension:
             kernel:
                 environment: e2e
             bootstrap: tests/bootstrap.php
         Behat\MinkExtension:
             files_path: "%paths.base%/tests/Behat/Files"
             base_url: http://nginx-agent
             browser_name: chrome
             sessions:
                 selenium:
                     selenium2:
                         wd_host: http://chrome:4444/wd/hub
                         browser: chrome
                         capabilities:
                             browserName: "chrome"
                             extra_capabilities:
                                 chromeOptions:
                                     w3c: false
                                     args:
                                         - "--headless"
                                         - "--no-sandbox"
                                         - "--disable-gpu"
                                         - "--disable-dev-shm-usage"
                                         - "--window-size=1920,1080"
                                         - "--force-prefers-reduced-motion"
.contexts: &contexts
    contexts:
        - App\Tests\Behat\BaseContext
        - App\Tests\Behat\DatabaseContext:
            kernel: '@kernel'
        - App\Tests\Behat\HttpContext
        - App\Tests\Behat\UserContext
        - FailAid\Context\FailureContext

default:
    suites:
        default:
            <<: *contexts

    extensions:
        FriendsOfBehat\SymfonyExtension:
            kernel:
                environment: test
            bootstrap: tests/bootstrap.php
        FailAid\Extension:
            screenshot:
                directory: ./build/screenshots/
                mode: default
                autoClean: true

func:
    suites:
        default:
            filters:
                tags: '~@javascript&&~@e2e'
    extensions:
        Behat\MinkExtension:
            sessions:
                symfony:
                    symfony: ~
        FriendsOfBehat\SymfonyExtension:
            kernel:
                environment: test
            bootstrap: tests/bootstrap.php

e2e:
    suites:
        complaint:
            paths:
                - '%paths.base%/features/complaint'
            <<: *contexts
            filters:
                tags: '~@func&&~@flaky'
        default:
            paths:
                - '%paths.base%/features/authenticate_user.feature'
                - '%paths.base%/features/bulk_actions.feature'
                - '%paths.base%/features/faq.feature'
                - '%paths.base%/features/home.feature'
                - '%paths.base%/features/notification.feature'
                - '%paths.base%/features/reporting.feature'
                - '%paths.base%/features/delegation_rights.feature'
            <<: *contexts
            filters:
                tags: '~@func&&~@flaky'
    <<: *extensions

flaky-e2e:
    suites:
        default:
            filters:
                tags: '@flaky'
    <<: *extensions
