{% extends 'layout.html.twig' %}

{% block body %}
    {% embed 'common/_modal.html.twig' with {'id':'complaint-confirm', 'size':'lg'} %}
        {% block title %}
            {{ 'pel.declaration.confirmation'|trans }}
        {% endblock %}
        {% block body %}
            <ul>
                <li>{{ 'pel.i.confirm.declaration.is.complete'|trans }}</li>
                <li>{{ 'pel.i.am.inform.of.article.434.26'|trans }}</li>
                <li>{{ 'pel.i.consent.use.of.data.for.fsi'|trans }}</li>
            </ul>
        {% endblock %}
        {% block footer %}
            <ul class="fr-btns-group fr-btns-group--right fr-btns-group--inline-reverse fr-btns-group--inline-lg fr-btns-group--icon-left">
                <li>
                    <a href="{{ path('complaint_appointment') }}" class="fr-btn fr-btn--icon-right fr-icon-arrow-right-line" id="appointment_submit">{{ 'pel.i.confirm'|trans }}</a>
                </li>
                <li>
                    <a href="{{ path('complaint_summary') }}" class="fr-btn fr-btn--secondary">
                        {{ 'pel.cancel'|trans }}
                    </a>
                </li>
            </ul>
        {% endblock %}
    {% endembed %}
    <div class="fr-container container">
        <h1>{{ 'pel.complaint.my.declaration'|trans }}</h1>
        {% include 'common/_complaint_nav.html.twig' with {'active':'summary'} %}
        <div class="wrapper--complaint">
            <h2>{{ 'pel.complaint.summary'|trans }}</h2>
            <div class="fr-grid-row">
                <div class="fr-col">
                    <h3>{{ 'pel.complaint.identification'|trans }}</h3>
                    <ul>
                        {{ include('common/_recap_identity.html.twig', {
                            civilState: complaint.identity.civilState,
                            contactInformation: complaint.identity.contactInformation,
                        }) }}
                        <li>{{ 'pel.want.to.receive.sms.notifications'|trans }}</li>
                        <li>
                            {{ 'pel.is.designated.as'|trans }}
                            {% if complaint.declarantStatus.declarantStatus is same as(constant('App\\AppEnum\\DeclarantStatus::Victim').value) %}
                                {{ 'pel.complaint.identity.victim'|trans }}
                            {% elseif complaint.declarantStatus.declarantStatus is same as(constant('App\\AppEnum\\DeclarantStatus::PersonLegalRepresentative').value) %}
                                {{ 'pel.complaint.identity.person.legal.representative'|trans }}
                            {% else %}
                                {{ 'pel.complaint.identity.corporation.legal.representative'|trans }}
                            {% endif %}
                            {{ 'pel.of.infraction'|trans }}
                        </li>
                    </ul>
                    {% if complaint.declarantStatus.declarantStatus is same as(constant('App\\AppEnum\\DeclarantStatus::PersonLegalRepresentative').value) %}
                        <p>{{ 'pel.represented.person.identity'|trans }}</p>
                        {{ include('common/_recap_identity.html.twig', {
                            civilState: complaint.identity.representedPersonCivilState,
                            contactInformation: complaint.identity.representedPersonContactInformation
                        }) }}
                    {% endif %}
                    {% if complaint.declarantStatus.declarantStatus is same as(constant('App\\AppEnum\\DeclarantStatus::CorporationLegalRepresentative').value) %}
                        <p><b>{{ 'pel.corporation.legal.information'|trans }}</b></p>
                        <ul>
                            <li>
                                {{ 'pel.corporation.siren'|trans }} :
                                {{ complaint.identity.corporation.siren }}
                            </li>
                            <li>
                                {{ 'pel.corporation.name'|trans }} :
                                {{ complaint.identity.corporation.name }}
                            </li>
                            <li>
                                {{ 'pel.corporation.function'|trans }} :
                                {{ complaint.identity.corporation.function }}
                            </li>
                            <li>
                                {{ 'pel.nationality'|trans }} :
                                {{ complaint.identity.corporation.nationality|nationality_get_name|trans }}
                            </li>
                            {% if complaint.identity.corporation.email %}
                                <li>
                                    {{ 'pel.corporation.email'|trans }} :
                                    {{ complaint.identity.corporation.email }}
                                </li>
                            {% endif %}
                            <li>
                                {{ 'pel.corporation.phone'|trans }} :
                                {{ complaint.identity.corporation.phone|phone_format_intl }}
                            </li>
                            <li>
                                {{ 'pel.address.country'|trans }} :
                                {{ complaint.identity.corporation.country|country_referential_name }}
                            </li>
                            <li>
                                {{ 'pel.address'|trans }} :
                                {% if complaint.identity.corporation.frenchAddress is not null %}
                                    {{ complaint.identity.corporation.frenchAddress.label }}
                                {% else %}
                                    {{ complaint.identity.corporation.foreignAddress.label }}
                                {% endif %}
                            </li>
                        </ul>
                    {% endif %}
                    <p>
                        <a class="fr-btn fr-btn--secondary btn--update" href="{{ path('complaint_identity', {'fromSummary':1}) }}" id="update-identity">{{ 'pel.update'|trans }}</a>
                    </p>
                </div>
            </div>
            <hr>
            <div class="fr-grid-row">
                <div class="fr-col">
                    <h3>{{ 'pel.facts.description'|trans }}</h3>
                    <ul>
                        <li>{{ 'pel.facts.description.precise'|trans }} : {{ complaint.facts.description }}</li>
                        <li>{{ 'pel.victim.at.time.of.facts'|trans }} : {{ complaint.facts.victimOfViolence ? 'pel.yes'|trans : 'pel.no'|trans }}</li>
                        {% if complaint.facts.victimOfViolence is same as(true) %}
                            <li>{{ 'pel.victim.at.time.of.facts.precisions'|trans }} : {{ complaint.facts.victimOfViolenceText }}</li>
                        {% endif %}
                        {% if complaint.facts.placeNature is not null %}
                            <li>
                                {{ 'pel.nature.place'|trans }} :
                                {% if complaint.facts.placeNature is same as(1) %}
                                    {{ 'pel.nature.place.home'|trans }}
                                {% elseif complaint.facts.placeNature is same as(2) %}
                                    {{ 'pel.nature.place.park'|trans }}
                                {% elseif complaint.facts.placeNature is same as(3) %}
                                    {{ 'pel.nature.place.street'|trans }}
                                {% elseif complaint.facts.placeNature is same as(4) %}
                                    {{ 'pel.nature.place.market'|trans }}
                                {% elseif complaint.facts.placeNature is same as(5) %}
                                    {{ 'pel.nature.place.public.transport'|trans }}
                                {% elseif complaint.facts.placeNature is same as(6) %}
                                    {{ 'pel.nature.place.other'|trans }}
                                {% else %}
                                    {{ 'pel.nature.place.unknown'|trans }}
                                {% endif %}
                            </li>
                        {% endif %}
                        <li>{{ 'pel.address.or.route.facts'|trans }} : {{ complaint.facts.address.addressOrRouteFactsKnown ? 'pel.yes'|trans : 'pel.no'|trans }}</li>
                        {% if complaint.facts.address.addressOrRouteFactsKnown is same as(true) %}
                            <li>{{ 'pel.address.start.or.exact'|trans }} : {{ complaint.facts.address.startAddress.label }}</li>
                            {% if complaint.facts.address.endAddress.label is not empty %}
                                <li>{{ 'pel.address.end'|trans }} : {{ complaint.facts.address.endAddress.label }}</li>
                            {% endif %}
                        {% endif %}
                        {% if complaint.facts.address.addressAdditionalInformation is not null %}
                            <li>{{ 'pel.additional.place.information'|trans }} : {{ complaint.facts.address.addressAdditionalInformation }}</li>
                        {% endif %}
                        <li>{{ 'pel.complaint.exact.date.known'|trans }} : {{ complaint.facts.offenseDate.exactDateKnown ? 'pel.yes'|trans : 'pel.no'|trans }}</li>
                        <li>
                            {{ 'pel.facts.date'|trans }} :
                            {% if complaint.facts.offenseDate.exactDateKnown is not null %}
                                {{ 'pel.the'|trans }} {{ complaint.facts.offenseDate.startDate|date('d/m/Y') }}
                            {% else %}
                                {{ 'pel.between'|trans|lower }} {{ 'pel.the'|trans|lower }} {{ complaint.facts.offenseDate.startDate|date('d/m/Y') }} {{ 'pel.and'|trans|lower }} {{ 'pel.the'|trans|lower }} {{ complaint.facts.offenseDate.endDate|date('d/m/Y') }}
                            {% endif %}
                        </li>
                        <li>
                            {{ 'pel.do.you.know.hour.facts'|trans }} :
                            {% if complaint.facts.offenseDate.choiceHour is same as('yes') %}
                                {{ 'pel.yes'|trans }}
                            {% elseif complaint.facts.offenseDate.choiceHour is same as('maybe') %}
                                {{ 'pel.no.but.you.know.the.time.slot'|trans }}
                            {% else %}
                                {{ 'pel.no'|trans }}
                            {% endif %}
                        </li>
                        {% if complaint.facts.offenseDate.choiceHour is same as('yes') or complaint.facts.offenseDate.choiceHour is same as('maybe') %}
                            <li>
                                {% if complaint.facts.offenseDate.hour  is not null %}
                                    {{ 'pel.exact.hour'|trans }} :
                                    {{ complaint.facts.offenseDate.hour|date('H:i') }}
                                {% else %}
                                    {{ 'pel.facts.hour'|trans }} :
                                    {{ 'pel.between'|trans|lower }} {{ complaint.facts.offenseDate.startHour|date('H:i') }} et {{ complaint.facts.offenseDate.endHour|date('H:i') }}
                                {% endif %}
                            </li>
                        {% endif %}
                    </ul>
                    <p>
                        <a class="fr-btn fr-btn--secondary btn--update" href="{{ path('complaint_facts', {'fromSummary':1}) }}" id="update-facts">{{ 'pel.update'|trans }}</a>
                    </p>
                </div>
            </div>
            <hr>
            <div class="fr-grid-row">
                <div class="fr-col">
                    <h3>{{ 'pel.objects.description'|trans }}</h3>
                    {% if complaint.objects.stolenObjects is not empty %}
                        <p>{{ 'pel.objects.stolen'|trans }}</p>
                        {% for object in complaint.objects.stolenObjects %}
                            {{ _self.object(object) }}
                        {% endfor %}
                    {% endif %}
                    {% if complaint.objects.degradedObjects is not empty %}
                        <p>{{ 'pel.objects.gradient'|trans }}</p>
                        {% for object in complaint.objects.degradedObjects %}
                            {{ _self.object(object) }}
                        {% endfor %}
                    {% endif %}
                    <p>{{ 'pel.total'|trans }}</p>
                    <p>
                        {% set objectsQuantity = complaint.objects.objects|objects_quantity %}
                        {{ 'pel.total.message.one'|trans }} {{ objectsQuantity }} {{ 'pel.total.message.two'|trans({'%quantity%': objectsQuantity}) }}
                        {{ 'pel.total.message.amount'|trans }} {{ complaint.objects.objects|objects_amount|format_currency('EUR', {fraction_digit: 2}) }}
                    </p>
                    <p>
                        <a class="fr-btn fr-btn--secondary btn--update" href="{{ path('complaint_objects', {'fromSummary':1}) }}" id="update-objects">{{ 'pel.update'|trans }}</a>
                    </p>
                </div>
            </div>
            <hr>
            <div class="fr-grid-row">
                <div class="fr-col">
                    <h3>{{ 'pel.additional.factual.information'|trans }}</h3>
                    <ul>
                        <li>{{ 'pel.facts.witnesses'|trans }} : {{ complaint.additionalInformation.witnesses ? 'pel.yes'|trans : 'pel.no'|trans }}</li>
                        {% if complaint.additionalInformation.witnesses is same as(true) %}
                            <li>{{ 'pel.facts.witnesses.information.text'|trans }} : {{ complaint.additionalInformation.witnessesText }}</li>
                        {% endif %}
                        <li>{{ 'pel.do.you.have.informations.on.potential.suspects'|trans }} : {{ complaint.additionalInformation.suspectsChoice ? 'pel.yes'|trans : 'pel.no'|trans }}</li>
                        {% if complaint.additionalInformation.suspectsChoice is same as(true) %}
                            <li>{{ 'pel.facts.suspects.informations.text'|trans }} : {{ complaint.additionalInformation.suspectsText }}</li>
                        {% endif %}
                        <li>
                            {{ 'pel.cctv.present'|trans }} :
                            {% if complaint.additionalInformation.cctvPresent is same as(constant('App\\Form\\Model\\AdditionalInformation\\AdditionalInformationModel::CCTV_PRESENT_YES')) %}
                                {{ 'pel.yes'|trans }}
                            {% elseif complaint.additionalInformation.cctvPresent is same as(constant('App\\Form\\Model\\AdditionalInformation\\AdditionalInformationModel::CCTV_PRESENT_NO')) %}
                                {{ 'pel.no'|trans }}
                            {% else %}
                                {{ 'pel.i.dont.know'|trans }}
                            {% endif %}
                        </li>
                        {% if complaint.additionalInformation.cctvPresent is same as(constant('App\\Form\\Model\\AdditionalInformation\\AdditionalInformationModel::CCTV_PRESENT_YES')) %}
                            <li>{{ 'pel.cctv.available'|trans }} : {{ complaint.additionalInformation.cctvAvailable ? 'pel.yes'|trans : 'pel.no'|trans }}</li>
                        {% endif %}
                        <li>{{ 'pel.fsi.visit'|trans }} : {{ complaint.additionalInformation.fsiVisit ? 'pel.yes'|trans : 'pel.no'|trans }}</li>
                        {% if complaint.additionalInformation.fsiVisit is not null %}
                            <li>{{ 'pel.observation.made'|trans }} : {{ complaint.additionalInformation.observationMade ? 'pel.yes'|trans : 'pel.no'|trans }}</li>
                        {% endif %}
                    </ul>
                    <p>
                        <a class="fr-btn fr-btn--secondary btn--update" href="{{ path('complaint_additional_information') }}" id="update-additional-information">{{ 'pel.update'|trans }}</a>
                    </p>
                </div>
            </div>
            {% if complaint.affectedService is not null %}
                <hr>
                {% set service = complaint.affectedService|service %}
                <div class="fr-grid-row">
                    <div class="fr-col">
                        <h3>{{ 'pel.place.complaint.handling'|trans }}</h3>
                        <ul>
                            <li>{{ service.publicName ?? service.name }} - {{ service.address|replace({'$': " "}) }}</li>
                        </ul>
                    </div>
                </div>
            {% endif %}
            <hr>
            <p><strong>{{ 'pel.note'|trans }}</strong> : {{ 'pel.summary.is.not.legal.proof'|trans }}</p>
            <div class="flex--between fr-mt-3w fr-mb-3w">
                <a href="{{ path('complaint_additional_information') }}" class="fr-btn fr-btn--secondary fr-btn--icon-left fr-icon-arrow-left-line">{{ 'pel.previous'|trans }}</a>
                <button class="fr-btn fr-float-right fr-btn--icon-right fr-icon-arrow-right-line" data-fr-opened="false" aria-controls="fr-modal-complaint-confirm">{{ 'pel.next'|trans }}</button>
            </div>
        </div>
    </div>
{% endblock %}

{% macro object(object) %}
    <ul>
        <li>{{ 'pel.object.category'|trans }} : {{ object.category|object_category_get_name|trans }}</li>
        {% if object.category|object_category_get_name is same as('pel.object.category.documents') %}
            <li>{{ 'pel.document.type'|trans }} : {{ object.documentType|document_type_label|trans }}</li>
            {% if object.documentType is same as(constant('App\\AppEnum\\DocumentType::Other').value) and object.otherDocumentType is not null %}
                <li>{{ 'pel.could.you.precise'|trans }} : {{ object.otherDocumentType }}</li>
            {% endif %}
            <li>{{ 'pel.i.am.the.owner.of.this.document'|trans }} : {{ object.documentOwned ? 'pel.yes'|trans : 'pel.no'|trans }}</li>
            {% if object.documentOwned is same as false and object.documentOwner is not empty %}
                <li>{{ 'pel.document.owner.lastname.fistname'|trans }} : {{ object.documentOwner }}</li>
            {% endif %}
        {% elseif object.category|object_category_get_name is same as('pel.object.category.multimedia') %}
            <li>{{ 'pel.object'|trans }} : {{ object.label }}</li>
            <li>{{ 'pel.brand'|trans }} : {{ object.brand }}</li>
            {% if object.model is not null %}
                <li>{{ 'pel.model'|trans }} : {{ object.model }}</li>
            {% endif %}
            {% if object.phoneNumberLine is not null and object.phoneNumberLine.number is not null %}
                <li>{{ 'pel.phone.number.line'|trans }} : {{ object.phoneNumberLine|phone_format_intl }}</li>
            {% endif %}
            {% if object.operator is not null %}
                <li>{{ 'pel.operator'|trans }} : {{ object.operator }}</li>
            {% endif %}
            {% if object.serialNumber is not null %}
                <li>{{ 'pel.serial.number'|trans }} : {{ object.serialNumber }}</li>
            {% endif %}
        {% elseif object.category|object_category_get_name is same as('pel.object.category.payment.ways') %}
            <li>{{ 'pel.object'|trans }} : {{ object.label }}</li>
            <li>{{ 'pel.organism.bank'|trans }} : {{ object.bank }}</li>
            <li>{{ 'pel.bank.account.number'|trans }} : {{ object.bankAccountNumber }}</li>
            {% if object.creditCardNumber %}
                <li>{{ 'pel.credit.card.number'|trans }} : {{ object.creditCardNumber }}</li>
            {% endif %}
        {% elseif object.category|object_category_get_name is same as('pel.object.category.registered.vehicle') %}
            <li>{{ 'pel.object'|trans }} : {{ object.label }}</li>
            <li>{{ 'pel.brand'|trans }} : {{ object.brand }}</li>
            {% if object.model is not null %}
                <li>{{ 'pel.model'|trans }} : {{ object.model }}</li>
            {% endif %}
            {% if object.registrationNumber is not null %}
                <li>{{ 'pel.registration.number'|trans }} : {{ object.registrationNumber }}</li>
            {% endif %}
            <li>{{ 'pel.registration.number.country'|trans }} : {{ object.registrationNumberCountry|country_name }}</li>
            {% if object.insuranceCompany is not null %}
                <li>{{ 'pel.insurance.company'|trans }} : {{ object.insuranceCompany }}</li>
            {% endif %}
            {% if object.insuranceNumber is not null %}
                <li>{{ 'pel.insurance.number'|trans }} : {{ object.insuranceNumber }}</li>
            {% endif %}
        {% elseif object.category|object_category_get_name is same as('pel.object.category.unregistered.vehicle') %}
            <li>{{ 'pel.object'|trans }} : {{ object.label }}</li>
        {% elseif object.category|object_category_get_name is same as('pel.object.category.other') %}
            <li>{{ 'pel.object'|trans }} : {{ object.label }}</li>
            <li>{{ 'pel.description'|trans }} : {{ object.description }}</li>
            <li>{{ 'pel.quantity'|trans }} : {{ object.quantity }}</li>
        {% endif %}
        {% if object.files is not empty %}
            {% for file in object.files %}
                <li>{{ 'pel.attachment'|trans }} {{ loop.index }} : <a href="{{ path('file_download', {'fileName':file.path, 'originalName':file.name}) }}" target="_blank">{{ file.name }}</a></li>
            {% endfor %}
        {% endif %}
        {% if object.amount is not null %}
            <li>{{ 'pel.amount'|trans }} : {{ object.amount|format_currency('EUR', {fraction_digit: 2}) }}</li>
        {% endif %}
    </ul>
{% endmacro %}
