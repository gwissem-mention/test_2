{% extends 'common/_complaint.html.twig' %}

{% set current_step_title = 'pel.registered.declaration'|trans %}
{% set isAppointmentRequiredOrAsked = complaint.isAppointmentRequired or complaint.appointment.appointmentAsked|default(false) %}
{% if isAppointmentRequiredOrAsked is same as(false) %}
    {% set current_step_number = 7 %}
{% else %}
    {% set current_step_number = 8 %}
{% endif %}

{% block title %}
    {% if isAppointmentRequiredOrAsked is same as(false) %}
        {{ 'pel.registered.declaration.title'|trans }}
    {% else %}
        {{ 'pel.registered.declaration.title.with.appointment'|trans }}
    {% endif %}
{% endblock %}

{% block content %}
    <div
        class="flex flex-col gap-y-8 md:gap-y-10 items-center fr-pt-10v fr-pb-12v fr-px-6v fr-pt-md-12v fr-px-md-20v fr-pb-md-20v">
        <div class="relative w-[100px] md:w-[120px] before:content-[''] before:absolute before:-left-1 before:top-0 before:w-[40px] before:h-full bg-white">
            <img class="relative" src="{{ asset('build/images/success.svg') }}" alt="">
        </div>
        <h1 class="text-center fr-mb-0 text-[28px]/9 md:text-[40px]/[48px]">{{ 'pel.end.thanks'|trans }}</h1>
        <form action="{{ path('complaint_summary_pdf') }}" method="post">
            <input type="hidden" name="complaint" value="{{ complaint_json }}">
            <button type="submit" class="fr-btn fr-btn--secondary fr-btn--icon-left fr-icon-download-fill fr-text--lg py-3 md:py-2.5 pr-6 pl-[18px] before:content-[''] before:w-6 before:h-6">
                {{ 'pel.download.my.declaration'|trans }}
            </button>
        </form>
        {% if complaint.affectedService is not null %}
            {% set unit = complaint.affectedService|unit %}
            {% if unit is not null %}
                <p class="text-xl/6 md:text-2xl text-center fr-text-mention--grey fr-mb-0"> {{ 'pel.place.complaint.handling'|trans }}</p>
                <div class="flex flex-col items-center gap-x-6 w-full md:flex-row">
                    {% if (unit.institutionCode is same as(constant('App\\AppEnum\\Institution::GN'))) %}
                        <img class="relative bg-white" src="{{ asset('build/images/gendarmerie.svg') }}" alt="">
                    {% elseif (unit.institutionCode is same as(constant('App\\AppEnum\\Institution::PN'))) %}
                        <img class="relative bg-white" src="{{ asset('build/images/police.svg') }}" alt="">
                    {% endif %}
                    <div class="flex flex-col text-center grow gap-y-2">
                        <b class="text-lg/6 md:text-[22px]/7">{{ unit.name }}</b>
                        <span class="text-base/5 md:text-lg/5 fr-text-mention--grey">{{ unit.address }}</span>
                    </div>
                </div>
            {% endif %}
        {% endif %}
    </div>
    <hr class="fr-pb-0">
    <div class="fr-px-6v fr-py-10v fr-px-md-20v fr-background-alt--blue-france text-center">
        <p class="text-lg/5 fr-text-mention--grey">{{ 'pel.your.opinion'|trans }}</p>
        <a class="bg-none relative inline-flex before:content-[''] before:absolute before:-left-2 before:-top-2 before:w-[calc(100%+1rem)] before:h-[calc(100%+1rem)] before:bg-[var(--pel-blue-france-975-75)]" href="https://jedonnemonavis.numerique.gouv.fr/Demarches/{{ jedonnemonavis_id }}?&view-mode=formulaire-avis&nd_source=button&key={{ jedonnemonavis_key }}" data-controller="focus" data-action="click->focus#focus">
            <img class="relative" src="https://jedonnemonavis.numerique.gouv.fr/static/bouton-bleu.svg" alt="{{ 'pel.your.opinion.alt'|trans }}"/>
        </a>
    </div>
{% endblock %}
